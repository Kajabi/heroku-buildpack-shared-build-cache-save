#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir> <env-dir>

set -eo pipefail

BUILD_DIR=$1
CACHE_DIR=$2
ENV_DIR=$3

RCLONE_DIST=rclone-current-linux-amd64
RCLONE_DIR=$CACHE_DIR/rclone

if [[ ! -d $RCLONE_DIR ]]; then
  echo "-----> Downloading rclone binary and inserting into \$PATH"
  curl -O https://downloads.rclone.org/$RCLONE_DIST.zip

  mkdir -p $RCLONE_DIR
  unzip -j $RCLONE_DIST.zip -d $RCLONE_DIR
else
  echo "-----> rclone is already downloaded; skipping"
fi

PATH="$RCLONE_DIR:$PATH"

echo "-----> Running .heroku/build-cache-save.sh"
source $BUILD_DIR/.heroku/build-cache-save.sh
